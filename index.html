<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>jQuery numberedTextarea Plugin Demo</title>
<link href="jquery.numberedtextarea.css" rel="stylesheet" type="text/css">
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">




<script>
  var IP;
  var SP=[];
  var function_name_array=[];
  var function_line_array=[];
  var code_line=[];
     // ------------------------function declaration ----------------------
      function function_definition(fun_line)
      {
        var temp=fun_line;
        var func_name=temp.replace(/\s+/g, '');
        var return_type;
        var fun_name_def=" ";
        var check1=3;
        var parameter_type;
        var parameter_name="";
        console.log(func_name);
        //console.log(func_name.length);
        for (var i=0;i<func_name.length;i++)
        {
          //--------return type--------------
          if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t' && check1==3)
          {
            return_type="int";
            console.log(return_type);
            check1=2;
            i=i+2;
          }
          else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d' && check1==3)
          {
            return_type="void";
            i=i+3;
            check1=2; 
            console.log(return_type +"return type " );
          }

          else if (func_name[i] !='(' && check1==2)
          {
            fun_name_def=fun_name_def+func_name[i];
          }
          if (func_name[i]=='(' && check1==2)
          {
            check1=4;
            //console.log(fun_name_def + " in check");
          }
          else if(check1==4 && func_name[i] !='(')
          {
                  
              if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t')
                {
                  parameter_type="int";
                  i=i+2
                }
              else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d')
              {
                parameter_type="void";
                i=i+3;
              }
              else if (func_name[i] !=')')
              {
                parameter_name=parameter_name+func_name[i];
              }

            }
        }
        console.log(return_type +"  "+fun_name_def+"  "+parameter_type+"  "+parameter_name  );
        return [return_type,fun_name_def,parameter_type,parameter_name];
      }

      // --------------------------function call--------------------------
      function function_call(call_function)
      {
        var fun=call_function;
        fun = fun.replace(/\s+/g, '');
        console.log(fun+"---"+fun.length);
        var fun_name="";
        check=false;
        var fun_arg="";
        for (var i=0;i<fun.length-2;i++)
        {
          if (fun[i] !='(' && check==false)
          
          {
            fun_name=fun_name+fun[i];
          }
          else
          {
            if (check==true)
            {
              fun_arg=fun_arg+fun[i]
            }
            check=true;
          }
        }
        console.log("function name  "+fun_name+"  fun argument "+fun_arg)
        return [fun_name,fun_arg];
      }

      function condition_if(if_line)
      {
        console.log(if_line);
        var if_cond=if_line.replace(/\s+/g, '');
        console.log(if_cond);
        var check2="1";
        var left_operand="";
        var right_operand="";
        var oper;
        for (var i=3;i<if_cond.length-1;i++)
        {
          //console.log(check2);
          if (check2=="2")
          {
            right_operand=right_operand+if_cond[i]; 
          }

          if (if_cond[i]=='>' || if_cond[i]=='<' || if_cond[i]=='=' || if_cond[i]=='!')
          {
            check2="2"
            if (if_cond[i]=='=')
            {
              oper="==";
              i=i+1;
            }

            else if (if_cond[i]=='!')
            {
              oper="!=";
              i=i+1;
            }
            else
            {
              oper=if_cond[i];
            }

          }
          if (check2=="1")
          {
            left_operand=left_operand+if_cond[i];
          
          }
        
        }
        console.log(left_operand +" "+right_operand+" "+oper);
      }
   
     function runFunction() 
     {
      function_name_array=[];
      function_line_array=[];
      code_line=[];
      var text=$("#editor").val();
      var token=text.split("\n");
      var func_array=[];
      var ip_set=false;
      for (var i=0;i<token.length;i++)
      {
        code_line.push(token[i]);
        var temp=code_line[i].replace(/\s+/g, '');
        if (temp[0]=='i' && temp[1]=='n' && temp[2]=='t' && temp[3]=='m' && temp[4]=='a' && temp[5]=='i' && temp[6]=='n' ) // check for main
        {
          IP=i+1;
          console.log("IP = "+IP);
          ip_set=true;
          SP.push("main"); 
        }
        if (temp[temp.length-1]==';' && temp[temp.length-2]==')' && ip_set) // check for funtion call
        {
          console.log(" function line" + i);
          function_call(code_line[i]);

        }
        else
        {
          var tmp=code_line[i].replace(/\s+/g, '');
          if (tmp[0]=='i' && tmp[1]=='f' && tmp[tmp.length-1]==')')
          {
            condition_if(code_line[i]);
          }
          else if( tmp[tmp.length-1]==')' && ip_set==false)
          {
            var re=function_definition(code_line[i]);

            function_name_array.push(re[1].replace(/\s+/g, ''));
            function_line_array.push(i);
          }

        }
      }
      console.log(code_line);
 }

    function downfunction()
    {
      if (SP !=null)
      {
        $("#memorymap").text(IP);
        var tmp=code_line[IP-1].replace(/\s+/g, '');
        if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && tmp[tmp.length-1]==';' && tmp[tmp.length-2]==')' )
        {
            IP=function_line_array[0];
        }
        else if (tmp[tmp.length-1]==';' && tmp[tmp.length-2]==')' )
        {
          var re=function_call(code_line[IP-1]);
          console.log(re[0]);
          console.log(function_name_array);
          var get_function_number=function_name_array.indexOf(re[0]);
          console.log(function_line_array[get_function_number]);
          IP=function_line_array[get_function_number];

        }
        if (tmp[0]=='i' && tmp[1]=='f')
        {
          
        }
        IP=IP+1;
      }
    }

    </script>

</head>

<body bgcolor="#E6F6FA">
    <h1 style="text-align:center; color: black;"><b>Recursive Learning </b></h1>  
  <table style="width:100%">
    <tr>
      <th>
        MEMORY MAPPER
      </th>
      <th>
        CODE EDITOR &nbsp;&nbsp;
        <button id="run_btn" onclick="runFunction()">
             Run
          </button>
      </th>
      <th>
        OUTPUT
      </th>
    </tr>
    <tr>
      <td style="width:30%">
          <canvas id="output" >
              Your browser does not support the HTML5 canvas tag.</canvas>
      </td>
      
      <td style="width:30%">
          <textarea id="editor" ></textarea>
      </td>
    
    <td style="width:20%" >
        <p><textarea id="memorymap"></textarea></p>
        
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
         &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<button class="button"  style="background:url('up.png')  center no-repeat; background-size: 100% 100%;"></button> </p>
        <p>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <button class="button" style="background:url('left.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" id="down" onclick=downfunction() style="background:url('down.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" style="background:url('right.png')  center no-repeat; background-size: 100% 100%;"></button>
        </p>
            
        
    </td>
    
  </tr>  
  
  </table>
  <script>
      var canvas=document.getElementById("output");
      var ctx=canvas.getContext("2d");
      ctx.fillStyle="#e6ccff";  // memory
      ctx.fillRect(10,5,280,130);  // (x , y,width,height) 
      ctx.fillStyle="#ffff80";    // code block yellow
      ctx.fillRect(15,15,85,75);
      ctx.fillStyle="#ffad33";   // pcb block orange
      ctx.fillRect(15,95,85,38);
      ctx.fillStyle="#bbff99";   // stack green
      ctx.fillRect(110,15,95,118);
      ctx.fillStyle="#66ccff";   // heap blue
      ctx.fillRect(210,15,75,90);
      
      ctx.fillStyle="#ffff80";  // teller box for code block 
      ctx.fillRect(5,140,10,5);
      ctx.fillStyle="#000000";
      ctx.font = "10 8px Arial";
      ctx.fillText("Code Block",20,145);

      ctx.fillStyle="#ffad33";  // teller box for PCB block 
      ctx.fillRect(70,140,10,5);
      ctx.fillStyle="#000000";
      ctx.font = "10 8px Arial";
      ctx.fillText("PCB Block",85,145);

      ctx.fillStyle="#bbff99";  // teller box for stack block 
      ctx.fillRect(135,140,10,5);
      ctx.fillStyle="#000000";
      ctx.font = "10 8px Arial";
      ctx.fillText("Stack Block",150,145);

      ctx.fillStyle="#66ccff";  // teller box for heap block 
      ctx.fillRect(200,140,10,5);
      ctx.fillStyle="#000000";
      ctx.font = "10 8px Arial";
      ctx.fillText("Heap Block",220,145);



    


    </script>  
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="jquery.numberedtextarea.js"></script>
<script>
$('#editor').numberedtextarea();
</script>

</body>
</html>
