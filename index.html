
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Recursive Learning</title>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<link href="jquery.numberedtextarea.css" rel="stylesheet" type="text/css">
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<script src="linklist.js"> </script>
<script src="funlinklist.js"></script>


<script>
  var TextEditor={
    codetext:"",
    if_line:0,
    else_line:0,
    getCode:function()
    {
      check3=true;
      $("#memorymap").text("");
      $("#output").text("");
      $("#outputip").text("");
      $("#outputstack").text("");

      codetext=$("#editor").val();
      Parser.parsecode(codetext);
      
    },
    getLine:function()
    {
   
        return Parser.code_line[MemoryMap.IP-1].replace(/\s+/g, '');
      
      
    },
    IterateOverCodeLineByLine:function(pre)

    {
      //console.log(MemoryMap.SP+"dfdfdsfds");
      if (MemoryMap.SP.length > 0 )
      {
        if (check3)
        {

          //$("#memorymap").text("IP =  "+MemoryMap.IP+MemoryMap.SP);
          $("#outputip").text("\n" +"  IP = "+MemoryMap.IP);
          $("div.numberedtextarea-number.numberedtextarea-number-"+MemoryMap.IP).attr('style', 'background-color: #20B2AA;');
          for (i=0;i<Parser.code_line.length;i++)
          {
            if (i != MemoryMap.IP)
            {
              $("div.numberedtextarea-number.numberedtextarea-number-"+i).attr('style', 'background-color:#34495E');
            }
          }

          var out1=" Data Segment"+"\n"+"_________________"+"\n";
          for (i=0;i<Parser.function_name_array.length;i++)
          {
            out1=out1+"  "+Parser.function_name_array[i]+"\n";
          }
          out1=out1+"  "+variable_name;
          $("#output").text(out1);

          var out="    Stack"+"\n"+"___________________"+"\n";

          for (i=MemoryMap.SP.length-1;i>=0;i--)
          {
             out=out+"  "+MemoryMap.SP[i]+"\n";
            
          }
          $("#outputstack").text(out);
          

        }
        else
        {
          for (i=0;i<Parser.code_line.length;i++)
          {
            if (i != MemoryMap.IP)
            {
              $("div.numberedtextarea-number.numberedtextarea-number-"+i).attr('style', 'background-color:#34495E');
            }
          }
          //$("#memorymap").text("IP =  "+MemoryMap.IP + "\n" + variable_name +" = "+variable_value+MemoryMap.SP);
          $("div.numberedtextarea-number.numberedtextarea-number-"+MemoryMap.IP).attr('style', 'background-color: #20B2AA;');
          $("#outputip").text("\n" +"  IP = "+MemoryMap.IP);
          var out1=" Data Segment"+"\n"+"_________________"+"\n";
          for (i=0;i<Parser.function_name_array.length;i++)
          {
            out1=out1+"  "+Parser.function_name_array[i]+"\n";
          }
          out1=out1+"  "+variable_name;
          $("#output").text(out1);


           var out="    Stack"+"\n"+"___________________"+"\n";
          for (i=MemoryMap.SP.length-1;i>=0;i--)
          {
             out=out+"  "+MemoryMap.SP[i]+"\n";
            
          }
          $("#outputstack").text(out);
         
          
        }
        
        
        var tmp=this.getLine();
        Parser.ParseCodeLine(tmp); 
        console.log(this.if_line);
        if (MemoryMap.IP==this.if_line && Parser.check4)
        {
          MemoryMap.IP=this.else_line;
        }
        MemoryMap.IP=MemoryMap.IP+1;
      }
    }
  }

  var Parser={
    code_line:[],
    function_name_array:[],
    function_line_array:[],
    check4:false, // for return statement 
    variable_list:"",
    function_link_list:"",
    ParseCodeLine:function(tmp)
    {
      
      this.isfunction(tmp);
      //this.isvariable(tmp);

      if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && this.check4 && tmp[6]=='n' || tmp[6]==1  )
      {
        MemoryMap.IP=MemoryMap.SP_line_number[MemoryMap.SP_line_number.length-1]-1;
        MemoryMap.SP_line_number.pop();
        MemoryMap.SP.pop();
        MemoryMap.SP.pop();
        //console.log("indide ppppppppp");


      }
      if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && tmp[6]==0)
      {
        
        MemoryMap.IP=MemoryMap.SP_line_number[MemoryMap.SP_line_number.length-1]-1;
        MemoryMap.SP_line_number.pop();
        MemoryMap.SP.pop();
        console.log("inside "+MemoryMap.SP);
        $("#outputip").text("IP = ");
          var out1="";
          for (i=0;i<Parser.function_name_array.length;i++)
          {
            out1=out1+Parser.function_name_array[i]+"\n";
          }
          out1=out1+variable_name;
          $("#output").text(out1);
          $("#outputstack").text(MemoryMap.SP);
      }

      if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && tmp[tmp.length-1]==';' && tmp[tmp.length-2]==')' && !this.check4)
        {   /*
          MemoryMap.SP_line_number.push(MemoryMap.IP);
          console.log(MemoryMap.SP_line_number);                                            
          MemoryMap.IP=this.function_line_array[0];
          variable_value=variable_value-1;
          MemoryMap.SP.push("factorial");
          MemoryMap.SP.push(variable_value);
            */

        }
        else if (tmp[tmp.length-1]==';' && tmp[tmp.length-2]==')' && !this.check4 )
        {
          /*var re=Parser.function_call(this.code_line[MemoryMap.IP-1]);
          console.log(re[0]);
          console.log(this.function_name_array);
          var get_function_number=this.function_name_array.indexOf(re[0]);
          console.log(this.function_line_array[get_function_number]);
          MemoryMap.SP_line_number.push(MemoryMap.IP);
          MemoryMap.IP=this.function_line_array[get_function_number];
          check3=false;
          MemoryMap.SP.push(re[0]);
          MemoryMap.SP.push(re[1]);
          */
          

        }
        if (tmp[0]=='i' && tmp[1]=='f')
        {
          
          if (! Parser.check_if_condition(this.code_line[MemoryMap.IP-1]))  // if condition false
          {
            console.log("inside the check condition");
            //console.log("variable name ", variable_name);
            //console.log("variable vale ",variable_value);
            var check_condition=true;
            while(check_condition)
            {
              MemoryMap.IP=MemoryMap.IP+1;
              var tmp=this.code_line[MemoryMap.IP-1].replace(/\s+/g, '');
              console.log(tmp);
              if (tmp[0]=='e' && tmp[1]=='l' && tmp[2]=='s' && tmp[3]=='e')
              {
                check_condition=false;
                MemoryMap.IP=MemoryMap.IP-1;
              }

            }

          }
          else  // if condition true
          {
            Parser.check4=true;
            console.log('inelse');
            var checkif_condition=true;
            TextEditor.if_line=MemoryMap.IP-1;
            while (checkif_condition)
            {
              
              var tmp1=this.code_line[TextEditor.if_line].replace(/\s+/g, '');
              if (tmp1=='}')
              {
                checkif_condition=false;
                //TextEditor.if_line=TextEditor.if_line+1;
                console.log(TextEditor.if_line);
              }
              TextEditor.if_line=TextEditor.if_line+1;
            }
            TextEditor.else_line=TextEditor.if_line;
            while(!checkif_condition)
            {
              var tmp2=this.code_line[TextEditor.else_line].replace(/\s+/g, '');
              console.log(tmp1);
              if (tmp2=='}')
              {
                checkif_condition=true;
                //TextEditor.else_line=TextEditor.else_line+1;
                console.log(TextEditor.else_line);
              }
              TextEditor.else_line=TextEditor.else_line+1;
            }


          }

        }

    },
    check_if_condition:function(cond)
     {
      var re=this.condition_if(cond);   // left , right, operator
           
          var left=this.variable_list.getvalue(re[0]);
          console.log(re[0]+" if condition--- "+left);
          this.variable_list.printlist(); 
          if (re[2]=='<')
          {
               
              if (left<re[1])
                return true;
              else
                return false;  
          }
          if (re[2]=='>')
          {
            if (left>re[1])
                return true;
              else
                return false;
          }
          if (re[2]=='==')
          {
            if (left==re[1])
                return true;
              else
                return false;
          }
     }
    ,
    condition_if:function(if_line)
      {
        console.log(if_line);
        var if_cond=if_line.replace(/\s+/g, '');
        console.log(if_cond);
        var check2="1";
        var left_operand="";
        var right_operand="";
        var oper;
        for (var i=3;i<if_cond.length-1;i++)
        {
          //console.log(check2);
          if (check2=="2")
          {
            right_operand=right_operand+if_cond[i]; 
          }

          if (if_cond[i]=='>' || if_cond[i]=='<' || if_cond[i]=='=' || if_cond[i]=='!')
          {
            check2="2"
            if (if_cond[i]=='=')
            {
              oper="==";
              i=i+1;
            }

            else if (if_cond[i]=='!')
            {
              oper="!=";
              i=i+1;
            }
            else
            {
              oper=if_cond[i];
            }

          }
          if (check2=="1")
          {
            left_operand=left_operand+if_cond[i];
          
          }
        
        }
        console.log(left_operand +" "+right_operand+" "+oper);
        return [left_operand,right_operand,oper];
      }
    ,
    function_call:function(call_function)
      {
        var fun=call_function;
        fun = fun.replace(/\s+/g, '');
        console.log(fun+"---"+fun.length);
        var fun_name="";
        check=false;
        var fun_arg="";
        for (var i=0;i<fun.length-2;i++)
        {
          if (fun[i] !='(' && check==false)
          
          {
            fun_name=fun_name+fun[i];
          }
          else
          {
            if (check==true)
            {
              fun_arg=fun_arg+fun[i]
            }
            check=true;
          }
        }
        
         variable_value=fun_arg;        
        //  console.log("function name  "+fun_name+"  fun argument "+fun_arg); 
        //  var what=this.function_link_list.setparaval(fun_name.replace(/\s+/g, ''),fun_arg);
        //  console.log(what+"what");
        //  this.function_link_list.printlist();
        
         return [fun_name,fun_arg];
        
        
      }
    ,
    function_definition:function(fun_line)
      {
        var temp=fun_line;
        var func_name=temp.replace(/\s+/g, '');
        var return_type;
        var fun_name_def=" ";
        var check1=3;
        var parameter_type;
        var parameter_name="";
        console.log(func_name);
        //console.log(func_name.length);
        for (var i=0;i<func_name.length;i++)
        {
          //--------return type--------------
          if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t' && check1==3)
          {
            return_type="int";
            console.log(return_type);
            check1=2;
            i=i+2;
          }
          else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d' && check1==3)
          {
            return_type="void";
            i=i+3;
            check1=2; 
            console.log(return_type +"return type " );
          }

          else if (func_name[i] !='(' && check1==2)
          {
            fun_name_def=fun_name_def+func_name[i];
          }
          if (func_name[i]=='(' && check1==2)
          {
            check1=4;
            //console.log(fun_name_def + " in check");
          }
          else if(check1==4 && func_name[i] !='(')
          {
                  
              if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t')
                {
                  parameter_type="int";
                  i=i+2
                }
              else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d')
              {
                parameter_type="void";
                i=i+3;
              }
              else if (func_name[i] !=')')
              {
                parameter_name=parameter_name+func_name[i];
              }

            }
        }
        variable_name=parameter_name;
        console.log(return_type +"  "+fun_name_def+"  "+parameter_type+"  "+parameter_name  );
        return [return_type,fun_name_def,parameter_type,parameter_name];
      },

    isfunction:function(functionline)
    {
      console.log(functionline);
      for (i=0;i<this.function_name_array.length;i++)
      {
        if (functionline.includes(this.function_name_array[i]) && functionline[functionline.length-1]==';')
        {
          console.log("yes function");
          MemoryMap.SP_line_number.push(MemoryMap.IP);
          MemoryMap.IP=this.function_line_array[i];
          check3=false;
          MemoryMap.SP.push(this.function_name_array[i]);
          var re=Parser.function_call(functionline);
          console.log(re[1]+"fdfjfdsfdsjfldsfldjfldsjfldsjfdlsjfds");
           if (this.isvariable(re[1]))
           {
                 console.log("not a interger");
                 var name=this.getvariable_name(re[1].replace(/\s+/g, ''));
                 var val=this.variable_list.getvalue(name.replace(/\s+/g, ''));
                 console.log(val+"valllllllllllllllllleeeeeeeeeeeeeee");
                 val=val-1;
                 this.variable_list.setvalue(name.replace(/\s+/g, ''),val);
                 console.log(name);
                 this.variable_list.printlist();

           }
          else
          {
            console.log("function name  "+re[0]+"  fun argument "+re[1]); 
            var what=this.function_link_list.setparaval(re[0].replace(/\s+/g, ''),re[1]);
            this.variable_list.setvalue(re[0].replace(/\s+/g, ''),3);
            console.log(what+"what");
          }
                                      
          //this.function_link_list.printlist();
          this.variable_list.printlist();
          this.function_link_list.printlist();
          
        }
      }
      

    },

    isvariable:function(variableline)
    {
     var var_array=this.variable_list.allvariable();
     console.log(var_array+" variables ");
     for (i=0;i<var_array.length;i++)
     {
       console.log(i);
       if (variableline.includes(var_array[i]))
       {
         console.log("variable line");
         console.log("trueeeeeeeeeeeeee");
         return true;
       }
     }
     console.log("flaseeeeeeee")
     return false;
    },
    getvariable_name:function(var_name)
    {
      var var_array=this.variable_list.allvariable();
     //console.log(var_array+" variables ");
     for (i=0;i<var_array.length;i++)
     {
       console.log(i);
       if (var_name.includes(var_array[i]))
       {
         return var_array[i];
       }
     }
    },

    getvar_name_values:function(text)
    {
      
      if (text[0]=='i' && text[1]=='n' && text[2]=='t' &&  text[text.length-1]==';' || text[text.length-1]==')' )
      {
        var name="";
        for (i=3;i<text.length;i++)
        {
          if (text[i] !=';' || text[i]!= ')')
          {
            name=name+text[i];
          }
        }
        //this.variable_list.add(name,"NAN","int")
      }
      if (text[0]=='f' && text[1]=='l' && text[2]=='o' && text[2]=='a' && text[2]=='t'&&  text[text.length-1]==")" || text[text.length-1]==';' && text[text.length-1]==',' )
      {

      }

     

    }
,
    parsecode:function(text)
    {
      
      this.variable_list=new linklist();
      this.function_link_list=new funlinklist();
      this.function_name_array=[];
      this.function_line_array=[];
      this.code_line=[]; 
      var token=text.split("\n");
      var func_array=[];
      var ip_set=false;
      for (var i=0;i<token.length;i++)
      { //this.getvar_name_values(token[i].replace(/\s+/g, ''))
        this.code_line.push(token[i]);
        var temp=this.code_line[i].replace(/\s+/g, '');
        if (temp[0]=='i' && temp[1]=='n' && temp[2]=='t' && temp[3]=='m' && temp[4]=='a' && temp[5]=='i' && temp[6]=='n' ) // check for main
        {
          MemoryMap.IP=i+1;
          console.log("IP = "+MemoryMap.IP);
          ip_set=true;
         MemoryMap.SP.push("main"); 
        }
        if (temp[temp.length-1]==';' && temp[temp.length-2]==')' && ip_set) // check for funtion call
        {
          console.log(" function line" + i);
          //this.function_call(this.code_line[i]);

        }
        else
        {
          var tmp=this.code_line[i].replace(/\s+/g, '');
          if (tmp[0]=='i' && tmp[1]=='f' && tmp[tmp.length-1]==')')
          {
            this.condition_if(this.code_line[i]);
          }
          else if( tmp[tmp.length-1]==')' && ip_set==false)
          {
            var re=this.function_definition(this.code_line[i]);

          this. function_name_array.push(re[1].replace(/\s+/g, ''));
          this.function_line_array.push(i);
          this.variable_list.add(re[3],"nan",re[2]);
          this.function_link_list.add(re[1].replace(/\s+/g, ''),re[0],re[3],re[2],i+1);
          
          }

        }
        
      }
      console.log(this.code_line);
      this.variable_list.printlist();
      this.function_link_list.printlist();
    }


  }

  var MemoryMap={
    IP:null,
    SP:[],
    SP_line_number:[], // return to line number when pop  
    sendStackvalues:function()
    {

    },
    sendIP:function()
    {

    },
    sendDataValues:function()
    {

    }
  }

  </script>




<script>

  var variable_name;
  var variable_value;
  var check3;
      
   
     function runFunction() 

     {
       TextEditor.if_line=0;
       TextEditor.else_line=0;
       MemoryMap.SP=[];
       Parser.check4=false;
       TextEditor.getCode();
     }

    function downfunction()
    {
      TextEditor.IterateOverCodeLineByLine();
      
    }
    
</script>
</head>

<body bgcolor="#E6F6FA">
    <h1 style="text-align:center; color: black;"><b>Recursive Learning </b></h1>  
    <div class="headings">

      <h3 class="mm">MEMORY MAPPER</h3>
      <h3 class="cr">CODE EDITOR</h3>
      <button  id="run_btn"  onclick="runFunction()" class="runbutton">Run </button>
      <h3 class="oo">OUTPUT</h3>


    </div>
    <div class="box">
      <div class="output_div">

          <textarea  id="output" readonly > </textarea>
      </br>
    </br>
          <textarea  id="outputip" readonly></textarea>
      </div>
      <div class="stack_div">
          <textarea id="outputstack"; readonly  > </textarea>

      </div>

    </div>

    <div class="box1">
        <textarea id="editor">
#include <iostream>
using namespace std;

int factorial(int number)
{
    if (number<1)
    {
        return 1;
    }
    else
    {
        return number*factorial(number-1);
    }
}

int main()
{
    factorial(3);  
    return 0;
}
                               
          </textarea>


    </div>

    <div class="box2">

      <div class="out"></div>
      <div class="movebuttons">
        <div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <button class="button"  style="background:url('up.png')  center no-repeat; background-size: 100% 100%;"></button></div>
          
          <button class="button" style="background:url('left.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" id="down" onclick=downfunction() style="background:url('down.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" style="background:url('right.png')  center no-repeat; background-size: 100% 100%;"></button>
    
        </div>
      
    </div> 

   
  <script>
    
</script>      
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="jquery.numberedtextarea.js"></script>
<script>
$('#editor').numberedtextarea();
</script>

</body>
</html>
