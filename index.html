
<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Recursive Learning</title>
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<link href="jquery.numberedtextarea.css" rel="stylesheet" type="text/css">
<link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
<script src="linklist.js"> </script>
<script src="funlinklist.js"></script>
<script src="math.js" type="text/javascript"></script>


<script>



  var TextEditor={
    codetext:"",
    if_line:0,
    else_line:0,
    getCode:function()
    {
      check3=true;
      $("#memorymap").text("");
      $("#output").text("");
      $("#outputip").text("");
      $("#outputstack").text("");

      codetext=$("#editor").val();
      Parser.parsecode(codetext);
      
    },
    getLine:function()
    {
   
        return Parser.code_line[MemoryMap.IP-1].replace(/\s+/g, '');
      
      
    },
    IterateOverCodeLineByLine:function(pre)

    {
      //console.log(MemoryMap.SP+"dfdfdsfds");
      if (MemoryMap.SP.length > 0 )
      
      {
        
        $("div.numberedtextarea-number.numberedtextarea-number-"+MemoryMap.IP).attr('style', 'background-color:#F9AA33');          for (i=0;i<Parser.code_line.length;i++)
          {
            if (i != MemoryMap.IP)
            {
              $("div.numberedtextarea-number.numberedtextarea-number-"+i).attr('style', 'background-color:#232F34');
            }
          }
        
        var tmp=this.getLine();
        Parser.ParseCodeLine(tmp); 
        console.log(this.if_line);
        //   if (MemoryMap.IP==this.if_line && Parser.check4)
        //   {
        //     MemoryMap.IP=this.else_line;
        //  }
        MemoryMap.IP=MemoryMap.IP+1;
      }
    }
  }

  var Parser={
    code_line:[],
    function_name_array:[],
    function_line_array:[],
    check4:false, // for return statement 
    variable_list:"",
    function_link_list:"",
    return_check:false,
    return_val:"",
    ParseCodeLine:function(tmp)
    {
        MemoryMap.sendIP();
        MemoryMap.sendStackvalues();
        MemoryMap.sendDataValues();
      

      if (!this.check4)
      {
        this.isfunction(tmp);
      }
      if(this.return_check)
      {
        console.log("in side the return check");
        console.log(tmp);
        var resub=tmp;
        var function_name;
        for (i=0;i<this.function_name_array.length;i++)
        {
          if (resub.includes(this.function_name_array[i]))
          {
            function_name=this.function_name_array[i];
          }
        }
        console.log(resub);
        var fun_idx=resub.indexOf(function_name);
        var tmpret="";
        for (i=fun_idx;resub[i-1] !=')' ;i++ )
        {
          tmpret=tmpret+resub[i];
        }
        tmp=tmp.replace(tmpret,this.return_val);
        console.log(tmp);
        //this.code_line[MemoryMap.IP]=o;
        //console.log(this.code_line[MemoryMap.IP]);
      }

      if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && this.check4  && tmp[6]!=0)
      {
        this.return_check=true;
        var ret_val=""; // to get the value of return        
        for (i=6;i<tmp.length-1;i++)
        {
          ret_val=ret_val+tmp[i];
        }
        this.return_val=ret_val;
        console.log(ret_val);
        MemoryMap.IP=MemoryMap.SP_line_number[MemoryMap.SP_line_number.length-1]-1;
        console.log(MemoryMap.IP);
        MemoryMap.SP_line_number.pop();
        MemoryMap.SP.pop();
        MemoryMap.SP.pop();
        //console.log("indide ppppppppppppppppppppppppppps");
        
        
      }
      else
      {
        this.return_check=false;
      }
      if (tmp[0]=='r' && tmp[1]=='e' && tmp[2]=='t' && tmp[3]=='u' && tmp[4]=='r' && tmp[5]=='n' && tmp[6]==0)
      {
        
        console.log("in return 0")
        MemoryMap.IP=MemoryMap.SP_line_number[MemoryMap.SP_line_number.length-1]-1;
        MemoryMap.SP_line_number.pop();
        MemoryMap.SP.pop();
      }

      if (tmp[0]=='i' && tmp[1]=='f')
        {
          
          if (! Parser.check_if_condition(this.code_line[MemoryMap.IP-1]))  // if condition false
          {
            console.log("inside the check condition");
            //console.log("variable name ", variable_name);
            //console.log("variable vale ",variable_value);
            var check_condition=true;
            while(check_condition)
            {
              MemoryMap.IP=MemoryMap.IP+1;
              var tmp=this.code_line[MemoryMap.IP-1].replace(/\s+/g, '');
              //console.log(tmp);
              //if (tmp[0]=='e' && tmp[1]=='l' && tmp[2]=='s' && tmp[3]=='e')
              if (tmp[0]=='}')
              {
                check_condition=false;
                MemoryMap.IP=MemoryMap.IP;
              }

            }

          }
          else  // if condition true
          {
            Parser.check4=true;
            // console.log('inelse');
            // var checkif_condition=true;
            // TextEditor.if_line=MemoryMap.IP-1;
            // while (checkif_condition)
            // {
              
            //   var tmp1=this.code_line[TextEditor.if_line].replace(/\s+/g, '');
            //   if (tmp1=='}')
            //   {
            //     checkif_condition=false;
            //     //TextEditor.if_line=TextEditor.if_line+1;
            //     //console.log(TextEditor.if_line);
            //   }
            //   TextEditor.if_line=TextEditor.if_line+1;
            // }
            // TextEditor.else_line=TextEditor.if_line;
            // while(!checkif_condition)
            // {
            //   var tmp2=this.code_line[TextEditor.else_line].replace(/\s+/g, '');
            //   console.log(tmp1);
            //   if (tmp2=='}')
            //   {
            //     checkif_condition=true;
            //     //TextEditor.else_line=TextEditor.else_line+1;
            //     //console.log(TextEditor.else_line);
            //   }
            //   TextEditor.else_line=TextEditor.else_line+1;
            
            // }


          }

        }
        

    },
    check_if_condition:function(cond)
     {
      var re=this.condition_if(cond);   // left , right, operator
           
          var left=this.variable_list.getvalue(re[0]);
          //console.log(re[0]+" if condition--- "+left);
          //this.variable_list.printlist(); 
          if (re[2]=='<')
          {
               
              if (left<re[1])
                return true;
              else
                return false;  
          }
          if (re[2]=='>')
          {
            if (left>re[1])
                return true;
              else
                return false;
          }
          if (re[2]=='==')
          {
            if (left==re[1])
                return true;
              else
                return false;
          }
     }
    ,
    condition_if:function(if_line)
      {
        console.log(if_line);
        var if_cond=if_line.replace(/\s+/g, '');
        console.log(if_cond);
        var check2="1";
        var left_operand="";
        var right_operand="";
        var oper;
        for (var i=3;i<if_cond.length-1;i++)
        {
          //console.log(check2);
          if (check2=="2")
          {
            right_operand=right_operand+if_cond[i]; 
          }

          if (if_cond[i]=='>' || if_cond[i]=='<' || if_cond[i]=='=' || if_cond[i]=='!')
          {
            check2="2"
            if (if_cond[i]=='=')
            {
              oper="==";
              i=i+1;
            }

            else if (if_cond[i]=='!')
            {
              oper="!=";
              i=i+1;
            }
            else
            {
              oper=if_cond[i];
            }

          }
          if (check2=="1")
          {
            left_operand=left_operand+if_cond[i];
          
          }
        
        }
        console.log(left_operand +" "+right_operand+" "+oper);
        return [left_operand,right_operand,oper];
      }
    ,
    function_call:function(call_function)
      {
        var fun=call_function;
        fun = fun.replace(/\s+/g, '');
        console.log(fun+"---"+fun.length);
        var fun_name="";
        check=false;
        var fun_arg="";
        for (var i=0;i<fun.length-2;i++)
        {
          if (fun[i] !='(' && check==false)
          
          {
            fun_name=fun_name+fun[i];
          }
          else
          {
            if (check==true)
            {
              fun_arg=fun_arg+fun[i]
            }
            check=true;
          }
        }
        
         variable_value=fun_arg; 
         return [fun_name,fun_arg];
        
        
      }
    ,
    function_definition:function(fun_line)
      {
        var temp=fun_line;
        var func_name=temp.replace(/\s+/g, '');
        var return_type;
        var fun_name_def=" ";
        var check1=3;
        var parameter_type;
        var parameter_name="";
        console.log(func_name);
        //console.log(func_name.length);
        for (var i=0;i<func_name.length;i++)
        {
          //--------return type--------------
          if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t' && check1==3)
          {
            return_type="int";
            console.log(return_type);
            check1=2;
            i=i+2;
          }
          else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d' && check1==3)
          {
            return_type="void";
            i=i+3;
            check1=2; 
            console.log(return_type +"return type " );
          }

          else if (func_name[i] !='(' && check1==2)
          {
            fun_name_def=fun_name_def+func_name[i];
          }
          if (func_name[i]=='(' && check1==2)
          {
            check1=4;
            //console.log(fun_name_def + " in check");
          }
          else if(check1==4 && func_name[i] !='(')
          {
                  
              if (func_name[i]=='i' && func_name[i+1]=='n' && func_name[i+2]=='t')
                {
                  parameter_type="int";
                  i=i+2
                }
              else if(func_name[i]=='v' && func_name[i+1]=='o' && func_name[i+2]=='i' && func_name[i+3]=='d')
              {
                parameter_type="void";
                i=i+3;
              }
              else if (func_name[i] !=')')
              {
                parameter_name=parameter_name+func_name[i];
              }

            }
        }
        variable_name=parameter_name;
        console.log(return_type +"  "+fun_name_def+"  "+parameter_type+"  "+parameter_name  );
        return [return_type,fun_name_def,parameter_type,parameter_name];
      },

    isfunction:function(functionline)
    {
      console.log(functionline);
      for (i=0;i<this.function_name_array.length;i++)
      {
        if (functionline.includes(this.function_name_array[i]) && functionline[functionline.length-1]==';')
        {
          console.log("yes function");
          MemoryMap.SP_line_number.push(MemoryMap.IP);
          MemoryMap.IP=this.function_line_array[i];
          check3=false;
          MemoryMap.SP.push(this.function_name_array[i]);
          var re=Parser.function_call(functionline);
          console.log(re[1]+"fdfjfdsfdsjfldsfldjfldsjfldsjfdlsjfds");
           if (this.arthimeticline(re[1]))
           {
             this.parsearthmetic(re[1]);
          }
          if (this.isvariable(re[1]))
           {
                  //      console.log("not a interger");
                 var name=this.getvariable_name(re[1].replace(/\s+/g, ''));
                  //var val=this.variable_list.getvalue(name.replace(/\s+/g, ''));
                  //console.log(val+"+valllllllllllllllllleeeeeeeeeeeeeee"+name);
                  //val=val-1;
                val=this.parsearthmetic(re[1]);
                 this.variable_list.setvalue(this.function_link_list.getpara(),val);
                 //console.log(name);
                 this.variable_list.printlist();
                 MemoryMap.SP.push(name+" = "+val);

           }
          else
          {
            console.log("function name  "+re[0]+"  fun argument "+re[1]); 
            var what=this.function_link_list.setparaval(re[0].replace(/\s+/g, ''),re[1]);
            //console.log(this.function_link_list.getpara()+"---------------------------------");
            this.variable_list.setvalue(this.function_link_list.getpara(),Number(re[1]));
            console.log(what+"what----"+re[0]);
            //var val=this.variable_list.getvalue("number");
            //console.log(val+"656654545");
            this.variable_list.printlist();
            MemoryMap.SP.push(this.function_link_list.getpara()+" = "+re[1]);

          }
                                      
          //this.function_link_list.printlist();
          this.variable_list.printlist();
          this.function_link_list.printlist();
          
        }
      }
      

    },

    isvariable:function(variableline)
    {
     var var_array=this.variable_list.allvariable();
     console.log(var_array+" variables ");
     for (i=0;i<var_array.length;i++)
     {
       console.log(i);
       if (variableline.includes(var_array[i]))
       {
         console.log("variable line");
         console.log("trueeeeeeeeeeeeee");
         return true;
       }
     }
     console.log("flaseeeeeeee")
     return false;
    },
    getvariable_name:function(var_name)
    {
      var var_array=this.variable_list.allvariable();
     //console.log(var_array+" variables ");
     for (i=0;i<var_array.length;i++)
     {
       console.log(i);
       if (var_name.includes(var_array[i]))
       {
         return var_array[i];
       }
     }
    },

    getvar_name_values:function(text)
    {
      
      if (text[0]=='i' && text[1]=='n' && text[2]=='t' &&  text[text.length-1]==';' || text[text.length-1]==')' )
      {
        var name="";
        for (i=3;i<text.length;i++)
        {
          if (text[i] !=';' || text[i]!= ')')
          {
            name=name+text[i];
          }
        }
      }
      if (text[0]=='f' && text[1]=='l' && text[2]=='o' && text[2]=='a' && text[2]=='t'&&  text[text.length-1]==")" || text[text.length-1]==';' && text[text.length-1]==',' )
      {

      }

     

    },
    arthimeticline:function(text)
    {
      ar_arry=['+','-','*','/'];
      for (i=0;i<ar_arry.length;i++)
      {
        
        if (text.includes(ar_arry[i]))
        {
          //console.log("arithmetic line");
          return true;
        }

      }
      return false;
    }, 
    parsearthmetic:function(text)
    {
      var operandarray=[];
      var string="";
      var operatorarray=[];
      if(this.arthimeticline(text))
      {
        for (i=0;i<text.length;i++)
        {
          
          if (text[i]=='+' || text[i]=='-' || text[i]=='*' || text[i]=='/')
          {
            operandarray.push(string);
            operatorarray.push(text[i]);
            string="";
          }
          else
          {
            string=string+text[i];
          }
          
        }
        string = "";
        string1="";
        i=text.length-1;
        while(text[i] !='+' && text[i]!='-' && text[i]!='*' && text[i]!='/')
        {
          if (text[i] != ';' && text[i]!=')')
          {
            string=string+text[i];
          }
          i--;
        }
        for (i=string.length-1;i>=0;i--)
        {
          string1=string1+string[i];
        }
        operandarray.push(string1);
      }
      console.log(operandarray);
      console.log(operatorarray);

      for (i=0;i<operatorarray.length;i++)
      {
        var arthstring="";
      if (Number(operandarray[i]))
      {
        console.log(true+"Maryam");
        var op1=Number(operandarray[i]);
        console.log(operandarray[i]);
        console.log(op1);
        arthstring=arthstring+op1;

      }
      else
      {
        op1=this.variable_list.getvalue(operandarray[i]);
        arthstring=arthstring+op1;
      }
      arthstring=arthstring+operatorarray[i];

      if (Number(operandarray[i+1]))
      {
        console.log(true+"Maryam");
        op2=Number(operandarray[i+1]);
        arthstring=arthstring+op2;
      }
      else
      {
        op2=this.variable_list.getvalue(operandarray[i+1]);
        arthstring=arthstring+op2;
      }  
    }
    var value=math.eval(arthstring);
  console.log(value+  " mariaaa");
  console.log(arthstring + " expression");
  return value;
    },
    parsecode:function(text)
    {
      
      this.variable_list=new linklist();
      this.function_link_list=new funlinklist();
      this.function_name_array=[];
      this.function_line_array=[];
      this.code_line=[]; 
      var token=text.split("\n");
      var func_array=[];
      var ip_set=false;
      for (var i=0;i<token.length;i++)
      { //this.getvar_name_values(token[i].replace(/\s+/g, ''))
        this.code_line.push(token[i]);
        var temp=this.code_line[i].replace(/\s+/g, '');
        if (temp[0]=='i' && temp[1]=='n' && temp[2]=='t' && temp[3]=='m' && temp[4]=='a' && temp[5]=='i' && temp[6]=='n' ) // check for main
        {
          MemoryMap.IP=i+1;
          console.log("IP = "+MemoryMap.IP);
          ip_set=true;
         MemoryMap.SP.push("main"); 
        }
        if (temp[temp.length-1]==';' && temp[temp.length-2]==')' && ip_set) // check for funtion call
        {
          console.log(" function line" + i);
          //this.function_call(this.code_line[i]);

        }
        else
        {
          var tmp=this.code_line[i].replace(/\s+/g, '');
          if (tmp[0]=='i' && tmp[1]=='f' && tmp[tmp.length-1]==')')
          {
            this.condition_if(this.code_line[i]);
          }
          else if( tmp[tmp.length-1]==')' && ip_set==false)
          {
            var re=this.function_definition(this.code_line[i]);

          this. function_name_array.push(re[1].replace(/\s+/g, ''));
          this.function_line_array.push(i);
          this.variable_list.add(re[3],"nan",re[2]);
          this.function_link_list.add(re[1].replace(/\s+/g, ''),re[0],re[3],re[2],i+1);
          
          }

        }
        
      }
      console.log(this.code_line);
      this.variable_list.printlist();
      this.function_link_list.printlist();
    },
  


  }

  var MemoryMap={
    IP:null,
    SP:[],
    SP_line_number:[], // return to line number when pop  
    sendStackvalues:function()
    {
      var out="  Stack"+"\n"+"______________"+"\n";
      for (i=MemoryMap.SP.length-1;i>=0;i--)
      {
          out=out+"  "+MemoryMap.SP[i]+"\n";
        
      }
      $("#outputstack").text(out);
      
    },
    sendIP:function()
    {
      $("#outputip").text("\n" +"  IP = "+MemoryMap.IP);
      
    },
    sendDataValues:function()
    {
      var out1="Data Segment"+"\n"+"____________"+"\n";
      for (i=0;i<Parser.function_name_array.length;i++)
      {
        out1=out1+"  "+Parser.function_name_array[i]+"\n";
      }
      out1=out1+"  "+variable_name;
      $("#output").text(out1);
    }
  }

  </script>




<script>

  var variable_name;
  var variable_value;
  var check3;
      
   
     function runFunction() 

     {
      console.log (math.eval('(2+1)*8/4.2'));
       TextEditor.if_line=0;
       TextEditor.else_line=0;
       MemoryMap.SP=[];
       Parser.check4=false;
       TextEditor.getCode();
       $("div.numberedtextarea-number.numberedtextarea-number-"+MemoryMap.IP).attr('style', 'background-color:#F9AA33');
       MemoryMap.sendStackvalues();
       MemoryMap.sendIP();
       MemoryMap.sendDataValues();
       MemoryMap.IP=MemoryMap.IP+1;

     }

    function downfunction()
    {
      TextEditor.IterateOverCodeLineByLine();
      
    }
    
</script>
</head>

<body bgcolor="#50636E">
    <h1 style="text-align:center; color: black;"><b>Recursive Learning </b></h1>  
    <div class="headings">

      <h3 class="mm">MEMORY MAPPER</h3>
      <h3 class="cr">CODE EDITOR</h3>
      <button  id="run_btn"  onclick="runFunction()" class="runbutton">Run </button>
      <h3 class="oo">OUTPUT</h3>


    </div>
    <div class="box">
      <div class="output_div">

          <textarea  id="output" readonly > </textarea>
      </br>
    </br>
          <textarea  id="outputip" readonly></textarea>
      </div>
      <div class="stack_div">
          <textarea id="outputstack"; readonly  > </textarea>

      </div>

    </div>

    <div class="box1">
        <textarea id="editor">
#include <iostream>
using namespace std;

int factorial(int number)
{
    if (number<1)
    {
        return 1;
    }
    else
    {
    return number*factorial(number-1);
    }
}

int main()
{
    factorial(3);  
    return 0;
}
                               
          </textarea>


    </div>

    <div class="box2">

      <div class="out"></div>
      <div class="movebuttons">
        <div>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
          <button class="button"  style="background:url('up.png')  center no-repeat; background-size: 100% 100%;"></button></div>
          
          <button class="button" style="background:url('left.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" id="down" onclick=downfunction() style="background:url('down.png')  center no-repeat; background-size: 100% 100%;" ></button>
          <button class="button" style="background:url('right.png')  center no-repeat; background-size: 100% 100%;"></button>
    
        </div>
      
    </div> 

   
  <script>
    
</script>      
<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
<script src="jquery.numberedtextarea.js"></script>
<script>
$('#editor').numberedtextarea();
</script>

</body>
</html>
